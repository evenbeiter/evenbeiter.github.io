<!DOCTYPE html>
<html>
<head>
  <title>API Proxy Tester</title>
</head>
<body>
  <h1>Python API Proxy Demo</h1>

  <h2>Result:</h2>
  <pre id="output">Waiting...</pre>

  <script>

async function getList(url){
  var res=await fetch(url);
  var str=await res.json();
  console.log(str);
}
    
      const url = 'https://today.line.me/api/v6/listings/80dd887e-a412-4ab5-9d69-c89960b5c27b?country=tw&offset=0&length=6';
      const method = 'GET';
      const paramStr = '';

      const proxyUrl = 'https://03e71654-f945-4524-a155-377d4f2b1a6e-00-2rayym3jder48.sisko.replit.dev/api/fetch';

      const output = document.getElementById('output');
      output.textContent = "Fetching...";

      if (method === "GET") {
        const fullUrl = `${proxyUrl}?url=${url}`;
        getList(fullUrl);
        // var res=await fetch(fullUrl);
        // var str=await res.json();
        // console.log(str);
        // fetch(fullUrl)
        //   .then(res => res.text())
        //   .then(data => output.textContent = data)
        //   .catch(err => output.textContent = 'Error: ' + err);
      } else {
        const formData = new URLSearchParams();
        formData.append('url', url);

        // Add user-provided params
        paramStr.split(',').forEach(pair => {
          const [key, value] = pair.split('=');
          if (key && value) formData.append(key.trim(), value.trim());
        });

        fetch(proxyUrl + '?url=' + encodeURIComponent(url), {
          method: 'POST',
          body: formData
        })
        .then(res => res.text())
        .then(data => output.textContent = data)
        .catch(err => output.textContent = 'Error: ' + err);
      }

  </script>
</body>
</html>
