<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Media Player</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>audio{margin-right:auto;margin-left:auto}.sticky-top, .fixed-bottom{background-color:#FFF}.table-hover tbody tr:hover td, .table-hover tbody tr:hover th{color:green}.h{display:none}[contenteditable]{outline: 0px solid transparent;}
    </style>
</head>
  <body>

    <div class="sticky-top">
        <audio id="ap" controls preload="auto" class="py-3 media-document audio iPhone"></audio>
        <video id="vp" controls preload="auto" playsinline style="display:none"></video>
    </div>

    <div>
        <div class="input-group px-3 py-1">
            <input id="mediaSrc" type="text" value="https://traffic.megaphone.fm/WSJ2860990505.mp3" class="form-control">
            <!-- <button class="btn btn-outline-secondary" type="button" value="" onclick="loadMedia()">Upload</button> -->
            <button class="btn btn-outline-secondary" type="button" onclick="loadMedia()">Upload</button>
            <button class="btn btn-secondary" type="button" onclick="playMedia()">PLAY</button>
        </div>

        <div id="input" class="input-group px-3 py-1">
            <!-- <span class="input-group-text">With textarea</span> -->
            <textarea id="tc" type="text" value="" class="form-control"></textarea>
            <button class="btn btn-outline-secondary" type="button" onclick="tc2Tbl()">LRC</button>
        </div>

    </div>

    <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="brown" class="bi bi-play-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l3.5-2.5a.5.5 0 0 0 0-.814z"/></svg> -->

    <div class="p-3">
        <table id="edit" class="table" contenteditable>
            <tbody id="lrc"></tbody>
        </table>
    </div>
    <div style="height:100px" onclick="stampTime()"></div>

    <div class="fixed-bottom">
        <div class="row">
            <!-- <div class="col border border-secondary p-3 text-center fw-bold" onclick="____()">D/L TXT</div>
            <div class="col border border-secondary p-3 text-center fw-bold" onclick="removeTS()">Remove TS</div>
            <div class="col border border-secondary p-3 text-center fw-bold" onclick="hitEnter()">New Line</div>
            <div class="col border border-secondary p-3 text-center fw-bold" onclick="stampTime()">TIMESTAMP</div> -->

            <button class="col btn btn-outline-secondary" type="button" onclick="____()">D/L TXT</button>
            <button class="col btn btn-outline-secondary" type="button" onclick="removeTS()">Remove TS</button>
            <button class="col btn btn-outline-secondary" type="button" onclick="hitEnter()">New Line</button>
            <button class="col btn btn-outline-secondary" type="button" onclick="stampTime()">TIMESTAMP</button>

        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.7.1.slim.min.js" integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script>

<script>

$('#tc').val("Alex Ossola: Here's your TNB Tech Minute for Friday, March 1st. I'm Alex Ossola for the Wall Street Journal. Elon Musk has sued OpenAI and its CEO Sam Altman. In the lawsuit, Musk alleges that OpenAI and Altman broke the artificial intelligence company's founding agreement by giving priority to profit over the benefits to humanity. Musk who helped found OpenAI in 2015 claims the company's close relationship with Microsoft goes against the company's original commitment to public open source AI. OpenAI declined to comment. Musk didn't respond to a request for comment. We exclusively report that Reddit plans to target a price range of $31 to $34 per share in its IPO. That's according to people familiar with the matter. That valuation of between 6 and $6.5 billion is down from the $10 billion valuation Reddit notched in its most recent fundraising round in August 2021? It's partly a reflection of investors waning appetite for unprofitable companies. The company can still adjust the range before its roadshow to pitch investors or listing, both of which are expected in the coming weeks. And Meta says it won't enter into new deals with traditional news publishers in Australia and the US. The company noted that the number of people in those countries using a dedicated tab for news on Facebook dropped more than 80% last year. In a blog post, the social media giant said people will still be able to view links to news articles on Facebook and that publishers will continue to have access to their accounts where they can post links just as anyone else. For a deeper dive into what's happening in tech, check out Monday's Tech News Briefing Podcast.");

function loadMedia(){
    $('#ap').attr('src',$('#mediaSrc').val());
}

function playMedia(){
    $('#ap')[0].play();
}

function stampTime(){
    for(var i=1;i<$("tr").length+1;i++){
        let el=document.getElementById('s'+i);
        let txt=el.textContent;
        if(txt.slice(0,1)!=='['){
            el.textContent=(timeMark($('#ap')[0].currentTime)+txt).replace('##:##.##','');
            el=document.getElementById('s'+(++i));
            txt=el.innerHTML;
            el.innerHTML='<span class="text-danger fw-bold">##:##.##</span>'+txt;
            break;
        }
    }
}

function removeTS(){

}


function hitEnter() {
    var sel, range;
    if (window.getSelection) {
        // IE9 and non-IE
        sel = window.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
            range = sel.getRangeAt(0);
            range.deleteContents();

            // Range.createContextualFragment() would be useful here but is
            // non-standard and not supported in all browsers (IE9, for one)
            var el = document.createElement("div");
            el.innerHTML='bbbbbb';
            //el.innerHTML = '<span>&lt;/td&gt;&lt;/tr&gt;</span>';
            //el.innerHTML = '<span>&lt;\u002F\u0074\u0064&gt;&lt;\u002F\u0074\u0072&gt;</span>';
            // el.innerHTML = '<strong>HERE</strong>';
            var frag = document.createDocumentFragment(), node, lastNode;
            while ( (node = el.firstChild) ) {
                lastNode = frag.appendChild(node);
            }
            range.insertNode(frag);
            
            // Preserve the selection
            // if (lastNode) {
            //     range = range.cloneRange();
            //     range.setStartAfter(lastNode);
            //     range.collapse(true);
            //     sel.removeAllRanges();
            //     sel.addRange(range);
            // }

            var newLrc=$('#lrc').html().replace('bbbbbb','</td></tr><tr><td>');
            $('#lrc').html(newLrc);
        }
    } 
}




function tc2Tbl(){
    $('#input').hide();
    var tc=$('#tc').val();
    var lines=tc.split(/[.?!]+/);

    var k='';var j=0;
    for (var i=0;i<lines.length;i++) {
        if (lines[i].trim() == "") {
            continue;
        }
            // k += '<tr><td>' +lines[i] + '.</td></tr>';
//             k += '<tr><td><span class="t border-0 shadow-none w-100 h-auto" contenteditable>' +lines[i] + '.</span></td></tr>';
            k += '<tr><td id="s'+(++j)+'">' +lines[i] + '.</td></tr>';

        }
    $("#lrc").html(k);

}



function timeMark(sec){
    let mm=Math.floor(sec/60);
    let ss=sec-mm*60;
    ss=ss.toFixed(2);
    return '['+[("0"+mm).slice(-2),("0"+ss).slice(-5)].join(':')+']';
}

$(function(){
    $(document).on("click", "table tbody tr", function(e) {


    });
});



// getData();
  
// async function getData(){
//     let response=await fetch('https://evenbeiter.github.io/project/list.json');
//     let str=await response.text();
//     let data=JSON.parse(str);
    
//     // let url=window.location.href;
//     //let url='https://evenbeiter.github.io/project/echo.html?id=1';
//     let i=Number(url.slice(-url.length+url.indexOf('=')+1));
//     let filename=data[i][0];
//     let name=filename.replace('_',':');
//     document.querySelector('title').textContent=name;
//     let mediaSrc=data[i][1];
//     $('#ap').attr('src',mediaSrc);

//     let lrcSrc='https://evenbeiter.github.io/project/src/'+filename+'.txt';
//     $('#delaySec').val(Number(data[i][2]));
//     delaySec=Number($('#delaySec').val())
//     getLrc(lrcSrc);
// }

// async function getLrc(url){
//     let response = await fetch(url);
//     let str = await response.text();
//     putlrc(str);
// }

// function delayTime(){
//     delaySec=Number($('#delaySec').val());
//     let title=document.querySelector('title').textContent;
//     let lrcSrc='https://evenbeiter.github.io/project/src/'+title.replace(':','_')+'.txt';
//     getLrc(lrcSrc);
// }

// function putlrc(d) {
//     var c = d.split("\r\n");
//     loadLrc2Page(c);
// }

// function loadLrc2Page(l) {
//     var d, e, h = [],
//         k = "";
//     var j = 0;

//     for (var f = 0; f < l.length; f++) {
//         if (l[f].trim() == "") {    //f=length of lrc
//             continue;
//         }
//         if (/\[\d\d:\d\d\.\d\d\]/.test(l[f])) {
//             var g = l[f].indexOf("]");
//             d = l[f].substr(1, g - 1);
//             e = l[f].substr(g + 1);
//             var c = s2n(d); //d=time; e=text; c=seconds; h=array of start time
//             h.push(parseFloat(c));
//             k += '<tr><td>' + (++j) + '</td><td class="h">' + c +'</td><td>' + e + '</td></tr>';
            
//         }
//     }

//     $("#lrc").html(k);

// }


// function s2n(a) {
//     n = a.split(":");
//     // n = parseInt(n[0]) * 60 + parseFloat(n[1]);
//     n = parseInt(n[0]) * 60 + parseFloat(n[1])+delaySec;
//     return n.toFixed(2);
// }


// $(function(){
//     $(document).on("click", "table tbody tr", function(e) {

//         let startTime=Number($(this).children(':nth-child(2)').text());
//         let endTime=Number($(this).next().children(':nth-child(2)').text());

//         startPlay(startTime,endTime);

//         async function startPlay(startTime,endTime){

//             let audio=$("#ap")[0];
//             let dr = audio.duration;

//             while (isNaN(dr)||dr===Infinity){
//             await new Promise(resolve=> setTimeout(resolve,200));
//             }
//             audio.currentTime=startTime;
//             audio.play();

//             setTimeout(()=>{
//                 audio.pause();
//                 audio.currentTime=startTime;
//             }, (endTime-startTime+0.1)*1000);
//         }

//     });
// });



</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
</body>
</html>
